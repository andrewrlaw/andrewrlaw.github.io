<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sortable tables</title>
    <link rel="stylesheet" href="ndis_zh.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
/* TABLE STYLES */

.NDIStable {
    border-collapse: collapse;
}

.NDIStable th,
.NDIStable td,
table.NDIStableSortable th.no-sort,
table.NDIStableSortable th button {
    text-align: left;
    padding: 16px;
}

table.NDIStableSortable th {
    padding: 0px;
}

.NDIStable thead th,
.NDIStable tfoot td,
.NDIStable tfoot th {
    font-family: '72 Bold';
    font-weight: 400;
}

.NDIStable thead th {
    border-bottom: 2px solid var(--purpleHeavy);
}

.NDIScardCallout thead th {
    border-bottom: 2px solid var(--black);
}

.NDIStable th:first-child,
table.NDIStableSortable th:first-child button,
.NDIStable td:first-child {
    padding-left: 0px;
}

.NDIStable td,
.NDIStable th {
    border-bottom: 1px solid var(--grey);
    font-family: '72 Regular';
    font-weight: 400;
}

.NDIStable tfoot tr td,
.NDIStable tfoot tr th {
    border-bottom: none;
}

.NDIStable tr.NDIStable_callout tfoot td,
.NDIStable tr.NDIStable_callout tfoot th {
    font-size: 24px;
}

.NDIStable.NDIStable_striped tr:nth-child(even) {
    background-color: var(--greyLight);
}

table.NDIStableSortable th {
    position: relative;
}

.NDIStable.NDIStableSortable thead th {
    font-family: '72 Regular';
}

table.NDIStableSortable th.no-sort {
    vertical-align: top;
    line-height: 24px;
    font-family: '72 Bold';
    font-weight: 400;
}

table.NDIStableSortable th button {
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
    outline: none;
    cursor: pointer;
    white-space: nowrap;
    padding-right: 32px;
    color: var(--black);
    text-decoration: none;
    border-radius: 0;
    font-family: '72 Bold';
    font-weight: 400;
}

table.NDIStableSortable th button {
    text-decoration: none;
}

table.NDIStableSortable th button span.thWrapper {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    min-height: 40px;
    min-width: 125px;
}

table.NDIStableSortable th button:hover {
    color: var(--black);
    text-decoration: underline;
}

table.NDIStableSortable th button span.thLabel span.thIcon:after {
    margin-left: 4px;
    display: inline-block;
    content: "\e5d7";
    font-family: 'Material Symbols Rounded';
    color: var(--purpleHeavy);
    font-size: 16px;
    vertical-align: text-bottom;
}

table.NDIStableSortable td.num {
    text-align: right;
}

/* Focus and hover styling */


table.NDIStableSortable th.ascending button,
table.NDIStableSortable th.descending button {
    color: var(--black);
    font-family: '72 Bold';
}

table.NDIStableSortable th span:nth-of-type(2),
table.NDIStableSortable th span:nth-of-type(2):hover,
table.NDIStableSortable th span:nth-of-type(3),
table.NDIStableSortable th span:nth-of-type(3):hover {
    display: block;
    color: var(--black);
    font-family: '72 Regular';
    font-size: 14px;
}
    </style>
</head>

<body>

    <table class="NDIStable NDIStableSortable">
        <caption class="sr-only">
            Students currently enrolled in WAI-ARIA 101, column headers with buttons are sortable.
        </caption>
        <thead>
            <tr>
                <th>
                    <button><span class="thWrapper">
                            <span class="thLabel">First Name<span class="thIcon" aria-hidden="true"></span></span>
                            <span class="sr-only info" aria-live="assertive">, sortable</span>
                        </span></button>
                </th>
                <th>
                    <button><span class="thWrapper">
                            <span class="thLabel">Last Name<span class="thIcon" aria-hidden="true"></span></span>
                            <span class="sr-only info" aria-live="assertive">, sortable</span>
                        </span></button>
                </th>
                <th>
                    <button><span class="thWrapper">
                            <span class="thLabel">Company<span class="thIcon" aria-hidden="true"></span></span>
                            <span class="sr-only info" aria-live="assertive">, sortable</span>
                        </span></button>
                </th>
                <th class="no-sort">Address</th>
                <th class="num">
                    <button><span class="thWrapper">
                            <span class="thLabel">Favorite Number<span class="thIcon" aria-hidden="true"></span></span>
                            <span class="sr-only info" aria-live="assertive">, sortable</span>
                        </span></button>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Fred</td>
                <td>Jackson</td>
                <td>Canary, Inc.</td>
                <td>123 Broad St.</td>
                <td class="num">56</td>
            </tr>
            <tr>
                <td>Sara</td>
                <td>James</td>
                <td>Cardinal, Inc.</td>
                <td>457 First St.</td>
                <td class="num">7</td>
            </tr>
            <tr>
                <td>Ralph</td>
                <td>Jefferson</td>
                <td>Robin, Inc.</td>
                <td>456 Main St.</td>
                <td class="num">513</td>
            </tr>
            <tr>
                <td>Nancy</td>
                <td>Jensen</td>
                <td>Eagle, Inc.</td>
                <td>2203 Logan Dr.</td>
                <td class="num">3.5</td>
            </tr>
        </tbody>
    </table>

</body>
<script>

    /*
   *   This content is licensed according to the W3C Software License at
   *   https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
   *
   *   File:   NDIStableSortable-table.js
   *
   *   Desc:   Adds sorting to a HTML data table that implements ARIA Authoring Practices
   */

'use strict';

class NDIStableSortableTable {
constructor(tableNode) {
    this.tableNode = tableNode;

    this.columnHeaders = tableNode.querySelectorAll('thead th');

    this.sortColumns = [];

    for (var i = 0; i < this.columnHeaders.length; i++) {
        var ch = this.columnHeaders[i];
        var buttonNode = ch.querySelector('button');
        if (buttonNode) {
            this.sortColumns.push(i);
            buttonNode.setAttribute('data-column-index', i);
            buttonNode.addEventListener('click', this.handleClick.bind(this));
        }
    }

    this.optionCheckbox = document.querySelector(
        'input[type="checkbox"][value="show-unsorted-icon"]'
    );

    if (this.optionCheckbox) {
        this.optionCheckbox.addEventListener(
            'change',
            this.handleOptionChange.bind(this)
        );
        if (this.optionCheckbox.checked) {
            this.tableNode.classList.add('show-unsorted-icon');
        }
    }
}

setColumnHeaderSort(columnIndex) {
    if (typeof columnIndex === 'string') {
        columnIndex = parseInt(columnIndex);
    }

    for (var i = 0; i < this.columnHeaders.length; i++) {
        var ch = this.columnHeaders[i];
        var buttonNode = ch.querySelector('button');
        if (i === columnIndex) {
            var value = ch.getAttribute('class');
            if (value === 'descending') {
                ch.setAttribute('class', 'ascending');
                this.sortColumn(
                    columnIndex,
                    'ascending',
                    ch.classList.contains('num')
                );
            } else {
                ch.setAttribute('class', 'descending');
                this.sortColumn(
                    columnIndex,
                    'descending',
                    ch.classList.contains('num')
                );
            }
        } else {
            if (ch.hasAttribute('class') && buttonNode) {
                ch.removeAttribute('class');
            }
        }
    }
}

sortColumn(columnIndex, sortValue, isNumber) {
    function compareValues(a, b) {
        if (sortValue === 'ascending') {
            if (a.value === b.value) {
                return 0;
            } else {
                if (isNumber) {
                    return a.value - b.value;
                } else {
                    return a.value < b.value ? -1 : 1;
                }
            }
        } else {
            if (a.value === b.value) {
                return 0;
            } else {
                if (isNumber) {
                    return b.value - a.value;
                } else {
                    return a.value > b.value ? -1 : 1;
                }
            }
        }
    }

    if (typeof isNumber !== 'boolean') {
        isNumber = false;
    }

    var tbodyNode = this.tableNode.querySelector('tbody');
    var rowNodes = [];
    var dataCells = [];

    var rowNode = tbodyNode.firstElementChild;

    var index = 0;
    while (rowNode) {
        rowNodes.push(rowNode);
        var rowCells = rowNode.querySelectorAll('th, td');
        var dataCell = rowCells[columnIndex];

        var data = {};
        data.index = index;
        data.value = dataCell.textContent.toLowerCase().trim();
        if (isNumber) {
            data.value = parseFloat(data.value);
        }
        dataCells.push(data);
        rowNode = rowNode.nextElementSibling;
        index += 1;
    }

    dataCells.sort(compareValues);

    // remove rows
    while (tbodyNode.firstChild) {
        tbodyNode.removeChild(tbodyNode.lastChild);
    }

    // add sorted rows
    for (var i = 0; i < dataCells.length; i += 1) {
        tbodyNode.appendChild(rowNodes[dataCells[i].index]);
    }
}

/* EVENT HANDLERS */

handleClick(event) {
    let tgt = event.currentTarget;
    this.setColumnHeaderSort(tgt.getAttribute('data-column-index'));
    const info = tgt.querySelector(".info");
    const th = tgt.parentElement;
    const infos = document.querySelectorAll('.info');
    infos.forEach(item => {
        item.classList.add('sr-only');
        item.innerHTML = ', sortable';
    });
    if (info && th) {
        const ariaSort = th.getAttribute('class');
        info.classList.remove('sr-only');
        info.setAttribute('aria-live', 'assertive');
        info.innerHTML = 'Sorted (' + ariaSort + ')';
    }
}

handleOptionChange(event) {
    var tgt = event.currentTarget;

    if (tgt.checked) {
        this.tableNode.classList.add('show-unsorted-icon');
    } else {
        this.tableNode.classList.remove('show-unsorted-icon');
    }
}
}

// Initialize NDIStableSortable table buttons
window.addEventListener('load', function () {
var NDIStableSortableTables = document.querySelectorAll('table.NDIStableSortable');
for (var i = 0; i < NDIStableSortableTables.length; i++) {
    new NDIStableSortableTable(NDIStableSortableTables[i]);
}
});

</script>

</html>